{% extends "GitonomyWebsiteBundle::layout_project.html.twig" %}

{% trans_default_domain 'project_source' %}

{% block title 'page.blame.title'|trans({'%project%': project.name, '%path%': path}) %}

{% set global_navigation = 'projects' %}
{% set local_navigation = 'source' %}

{% block project_content %}

    {% include "GitonomyWebsiteBundle:Project:_pathcrumb.html.twig" with {active: "blame"} %}
    <table class="table">
        <tbody>
            {% for x in blame.groupedLines %}
                {% set commit, lines = x[0], x[1] %}
                <tr>
                    <td rowspan="{{ lines|length }}">
                        <strong>{{ commit.authorName }}</strong> - {{ commit.authorDate.format('Y-m-d H:i:s') }}
                        <br />
                        <a href="{{ path('project_commit', {slug: project.slug, hash: commit.hash}) }}">{{ commit.shortMessage }}</a>
                    </td>
                    {% for lineNumber, line in lines %}
                        {% if not loop.first %}
                            <tr>
                        {% endif %}
                                <td>{{ lineNumber }}</td>
                                <td>{{ line.content }}</td>
                            </tr>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
