{% extends "GitonomyWebsiteBundle::layout_project.html.twig" %}

{% block title app.request.attributes.get('slug') ~ ' - Admin' %}

{% set global_navigation = 'projects' %}
{% set local_navigation = 'permissions' %}

{% trans_default_domain "project_permissions" %}

{% block project_content %}
    <div id="content">
        <h2>{{ 'title.user_role'|trans }}</h2>
        <form method="POST" action="{{ path('project_postPermissionsCreateRole', {slug: project.slug}) }}">
            {{ form_errors(roleForm) }}
            <table class="bordered-table table table-striped">
                <thead>
                    <tr>
                        <th>{{ 'table.role.column.user'|trans }}</th>
                        <th>{{ 'table.role.column.role'|trans }}</th>
                        <th>{{ 'table.role.column.actions'|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for userRole in project.userRoles %}
                        <tr>
                            <td>{{ userRole.user.fullname }}</td>
                            <td>{{ userRole.role.name }}</td>
                            <td>
                                <a data-method="POST" href="{{ path('project_postPermissionsDeleteRole', {slug: project.slug, id: userRole.id, _token: token}) }}">
                                    <i class="symbol">trash</i> {{ 'link.role.delete'|trans }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td>
                            {{ form_widget(roleForm.user) }}
                            {{ form_errors(roleForm.user) }}
                        </td>
                        <td>
                            {{ form_widget(roleForm.role) }}
                            {{ form_errors(roleForm.role) }}
                        </td>
                        <td><input type="submit" class="btn btn-success" value="{{ 'form.role.submit'|trans }}" /></td>
                    </tr>
                </tfoot>
            </table>
            {{ form_rest(roleForm) }}
        </form>
        <h2>{{ 'title.git_accesses'|trans }}</h2>
        <form method="POST" action="{{ path('project_postPermissionsCreateGitAccess', {slug: project.slug}) }}">
            {{ form_errors(gitAccessForm) }}
            <table class="bordered-table table table-striped">
                <thead>
                    <tr>
                        <th>{{ 'table.git_accesses.column.role'|trans }}</th>
                        <th>{{ 'table.git_accesses.column.reference'|trans }}</th>
                        <th>{{ 'table.git_accesses.column.admin'|trans }}</th>
                        <th>{{ 'table.git_accesses.column.role'|trans }}</th>
                        <th>{{ 'table.git_accesses.column.actions'|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for gitAccess in project.gitAccesses %}
                        <tr>
                            <td>{{ gitAccess.role.name }}</td>
                            <td>{{ gitAccess.reference }}</td>
                            <td>{{ (gitAccess.write ? '<i class="symbol">ok</i>' : '&nbsp;')|raw }}</td>
                            <td>{{ (gitAccess.admin ? '<i class="symbol">ok</i>' : '&nbsp;')|raw }}</td>
                            <td>
                                <a data-method="POST" href="{{ path('project_postPermissionsDeleteGitAccess', {slug: project.slug, id: gitAccess.id, _token: token}) }}">
                                    <i class="symbol">trash</i> {{ 'link.git_access.delete'|trans }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td>
                            {{ form_widget(gitAccessForm.role) }}
                            {{ form_errors(gitAccessForm.role) }}
                        </td>
                        <td>
                            {{ form_widget(gitAccessForm.reference) }}
                            {{ form_errors(gitAccessForm.reference) }}
                        </td>
                        <td>
                            {{ form_widget(gitAccessForm.write) }}
                            {{ form_errors(gitAccessForm.write) }}
                        </td>
                        <td>
                            {{ form_widget(gitAccessForm.admin) }}
                            {{ form_errors(gitAccessForm.admin) }}
                        </td>
                        <td><input type="submit" class="btn btn-success" value="{{ 'form.git_access.submit'|trans }}" /></td>
                    </tr>
                </foot>
            </table>
            {{ form_rest(gitAccessForm) }}
        </form>
    </div>
{% endblock %}
